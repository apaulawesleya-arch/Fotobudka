<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ania & Damian â€“ Weselna Fotobudka</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #fff0f5;
      padding: 2em;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 0.3em;
    }
    p {
      font-size: 1.2em;
      margin-bottom: 1.5em;
    }
    video {
      border: 4px solid #e91e63;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      height: auto;
      margin-bottom: 1em;
    }
    canvas {
      display: none;
      margin-top: 1em;
    }
    button {
      padding: 12px 25px;
      font-size: 1.1em;
      background-color: #e91e63;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 0.5em;
    }
    button:hover {
      background-color: #d81b60;
    }
    #downloadLink {
      display: none;
      margin-top: 1em;
      font-size: 1.1em;
      text-decoration: none;
      color: #e91e63;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Ania & Damian â€“ Weselna Fotobudka ğŸ“¸</h1>
  <p>ZrÃ³b zdjÄ™cie i podziel siÄ™ nim z nami! ğŸ•Šï¸</p>

  <video id="video" autoplay playsinline></video>
  <br>
  <button onclick="takePhoto()">ğŸ“¸ ZrÃ³b zdjÄ™cie</button>
  <button onclick="switchCamera()">ğŸ”„ PrzeÅ‚Ä…cz kamerÄ™</button>
  <button onclick="toggleFlash()">ğŸ’¡ Lampa: <span id="flashStatus">OFF</span></button>

  <canvas id="canvas" width="400" height="300"></canvas>
  <br>
  <a id="downloadLink">ğŸ“¥ Pobierz zdjÄ™cie</a>
  <br>
  <button onclick="goToForm()">ğŸ“¤ PrzeÅ›lij zdjÄ™cie do formularza</button>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const downloadLink = document.getElementById('downloadLink');
    const flashStatus = document.getElementById('flashStatus');

    let currentStream;
    let currentCamera = 'environment';
    let flashOn = false;

    async function startCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }

      const constraints = {
        video: {
          facingMode: currentCamera,
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };

      try {
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = currentStream;
        await video.play();
      } catch (err) {
        alert("Nie udaÅ‚o siÄ™ uzyskaÄ‡ dostÄ™pu do kamery ğŸ˜¢");
        console.error(err);
      }
    }

    function switchCamera() {
      currentCamera = currentCamera === 'environment' ? 'user' : 'environment';
      startCamera();
    }

    function toggleFlash() {
      const videoTrack = currentStream?.getVideoTracks()[0];
      const capabilities = videoTrack?.getCapabilities?.();
      if (!capabilities || !capabilities.torch) {
        alert("Twoje urzÄ…dzenie nie obsÅ‚uguje lampy bÅ‚yskowej");
        return;
      }

      flashOn = !flashOn;
      videoTrack.applyConstraints({ advanced: [{ torch: flashOn }] });
      flashStatus.textContent = flashOn ? 'ON' : 'OFF';
    }

    function takePhoto() {
      const context = canvas.getContext('2d');
      canvas.style.display = 'block';
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const dataUrl = canvas.toDataURL('image/png');
      downloadLink.href = dataUrl;
      downloadLink.download = 'fotobudka.png';
      downloadLink.style.display = 'inline-block';
    }

    function goToForm() {
      window.open("https://docs.google.com/forms/d/e/1FAIpQLSdJdysTEt9T6D6xpV8Pttmb2sHyH3wyPmZdgGiWTvn1DU-V7g/viewform", "_blank");
    }

    window.addEventListener('load', startCamera);
  </script>
</body>
</html>
